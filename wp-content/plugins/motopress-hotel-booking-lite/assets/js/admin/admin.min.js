!function(e){e(function(){MPHB.BookingsCalendar=can.Control.extend({},{filtersForm:null,customPeriodWrapper:null,btnPeriodPrev:null,btnPeriodNext:null,periodEl:null,init:function(e,t){this.filtersForm=this.element.find("#mphb-bookings-calendar-filters"),this.customPeriodWrapper=this.filtersForm.find(".mphb-custom-period-wrapper"),this.btnPeriodPrev=this.filtersForm.find(".mphb-period-prev"),this.btnPeriodNext=this.filtersForm.find(".mphb-period-next"),this.periodEl=this.filtersForm.find("#mphb-bookings-calendar-filter-period"),this.searchDateFromEl=this.filtersForm.find(".mphb-search-date-from"),this.searchDateToEl=this.filtersForm.find(".mphb-search-date-to"),this.initDatepickers()},initDatepickers:function(){this.filtersForm.find(".mphb-datepick").datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,showSpeed:0,showOtherMonths:!0,monthsToShow:MPHB.Plugin.myThis.data.settings.numberOfMonthDatepicker,pickerClass:MPHB.Plugin.myThis.data.settings.datepickerClass})},"#mphb-bookings-calendar-filter-period change":function(t,i){"custom"===e(t).val()?(this.customPeriodWrapper.removeClass("mphb-hide"),this.btnPeriodNext.addClass("mphb-hide"),this.btnPeriodPrev.addClass("mphb-hide")):(this.customPeriodWrapper.addClass("mphb-hide"),this.btnPeriodNext.removeClass("mphb-hide"),this.btnPeriodPrev.removeClass("mphb-hide"))},"#mphb-booking-calendar-search-room-availability-status change":function(t,i){""===e(t).val()?(this.searchDateFromEl.addClass("mphb-hide"),this.searchDateToEl.addClass("mphb-hide")):(this.searchDateFromEl.removeClass("mphb-hide"),this.searchDateToEl.removeClass("mphb-hide"))}}),MPHB.format_price=function(t,i){i=i||{};var n=MPHB.Plugin.myThis.data.settings.currency;return i=e.extend({},n,i),t=MPHB.number_format(t,i.decimals,i.decimal_separator,i.thousand_separator),'<span class="mphb-price">'+i.price_format.replace("%s",t)+"</span>"},MPHB.format_percentage=function(t,i){i=i||{};var n=MPHB.Plugin.myThis.data.settings.currency;return i=e.extend({},n,i),'<span class="mphb-percentage">'+(t=MPHB.number_format(t,i.decimals,i.decimal_separator,i.thousand_separator))+"%</span>"},MPHB.number_format=function(e,t,i,n){var r,s,a,l,o,h="";return t=t||0,i=i||".",n=n||",",e<0&&(h="-",e*=-1),r=parseInt(e=(+e||0).toFixed(t))+"",(s=r.length)>3?s%=3:s=0,o=s?r.substr(0,s)+n:"",a=r.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+n),l=t?i+Math.abs(e-r).toFixed(t).replace(/-/,0).slice(2):"",h+o+a+l},MPHB.Plugin=can.Construct.extend({myThis:null},{data:null,init:function(t,i){MPHB.Plugin.myThis=this,this.data=MPHB._data,delete MPHB._data;var n=e(".mphb-ctrl:not([data-inited])");this.setControls(n)},getVersion:function(){return this.data.version},getPrefix:function(){return this.data.prefix},addPrefix:function(e,t){return t=void 0!==t?t:"-",this.getPrefix()+t+e},setControls:function(t){var i,n;e.each(t,function(){switch(n=e(this).attr("data-type")){case"text":break;case"number":i=new MPHB.NumberCtrl(e(this));break;case"total-price":i=new MPHB.TotalPriceCtrl(e(this));break;case"price-breakdown":i=new MPHB.PriceBreakdownCtrl(e(this));break;case"gallery":i=new MPHB.GalleryCtrl(e(this));break;case"datepicker":i=new MPHB.DatePickerCtrl(e(this));break;case"color-picker":i=new MPHB.ColorPickerCtrl(e(this));break;case"complex":i=new MPHB.ComplexCtrl(e(this));break;case"complex-vertical":i=new MPHB.ComplexVerticalCtrl(e(this));break;case"dynamic-select":i=new MPHB.DynamicSelectCtrl(e(this));break;case"multiple-checkbox":i=new MPHB.MultipleCheckboxCtrl(e(this));break;case"amount":i=new MPHB.AmountCtrl(e(this));break;case"rules-list":i=new MPHB.RulesListCtrl(e(this))}e(this).attr("data-inited",!0)})}}),MPHB.WPGallery=can.Construct.extend({myThis:null,getInstance:function(){return null===MPHB.WPGallery.myThis&&(MPHB.WPGallery.myThis=new MPHB.WPGallery),MPHB.WPGallery.myThis}},{frame:null,ctrl:null,init:function(){MPHB.WPGallery.myThis=this,Attachment=wp.media.model.Attachment,wp.media.controller.MPHBGallery=wp.media.controller.FeaturedImage.extend({defaults:parent._.defaults({id:"mphb-media-library-gallery",title:MPHB.Plugin.myThis.data.translations.roomTypeGalleryTitle,toolbar:"main-insert",filterable:"uploaded",library:wp.media.query({type:"image"}),multiple:"add",editable:!0,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var e,t=this.get("selection"),i=MPHB.WPGallery.myThis.ctrl.get();""!==i&&-1!==i&&(e=parent._.map(i.split(/,/),function(e){return Attachment.get(e)})),t.reset(e)}}),wp.media.view.MediaFrame.MPHBGallery=wp.media.view.MediaFrame.Post.extend({createStates:function(){this.options;this.states.add([new wp.media.controller.MPHBGallery])},bindHandlers:function(){wp.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("toolbar:create:main-insert",this.createToolbar,this);var e={content:{embed:"embedContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar"}};parent._.each(e,function(e,t){parent._.each(e,function(e,i){this.on(t+":render:"+i,this[e],this)},this)},this)},mainInsertToolbar:function(e){var t=this;this.selectionStatusToolbar(e),e.set("insert",{style:"primary",priority:80,text:MPHB.Plugin.myThis.data.translations.addGalleryToRoomType,requires:{selection:!0},click:function(){var e=t.state(),i=e.get("selection");t.close(),e.trigger("insert",i).reset()}})}}),this.frame=new wp.media.view.MediaFrame.MPHBGallery(parent._.defaults({},{state:"mphb-media-library-gallery",library:{type:"image"},multiple:!0})),this.frame.on("open",this.proxy("onOpen")),this.frame.on("insert",this.proxy("setImage"))},open:function(e){this.ctrl=e,this.frame.open()},onOpen:function(){var e=this.frame;e.reset();var t=this.ctrl.getArray();if(t.length){var i=null;t.forEach(function(t){i=wp.media.attachment(t),i.fetch(),e.state().get("selection").add(i)})}},setImage:function(){var t=[],i=this.frame.state().get("selection").models;e.each(i,function(e,i){var n=i.attributes;t.push(n.id)}),this.ctrl.set(t.join(","))}}),MPHB.Ctrl=can.Control.extend({renderValue:function(e){var t=e.attr("data-type");return e.find('input[type="'+t+'"]').val()}},{parentForm:null,init:function(e,t){this.parentForm=this.element.closest("form")}}),MPHB.AmountCtrl=MPHB.Ctrl.extend({renderValue:function(t){var i=t.find('input[type="number"]:not(:disabled)'),n=t.children(".mphb-amount-inputs").attr("data-render-type"),r="price"==n?MPHB.format_price:MPHB.format_percentage;if(1==i.length)return r(i.val());var s=MPHB.Plugin.myThis.data.translations.adults;return s+=r(e(i[0]).val()),s+="<br />"+MPHB.Plugin.myThis.data.translations.children,s+=r(e(i[1]).val())}},{mainWrapper:null,singleInputGroup:null,multipleInputsGroup:null,commonAmountInput:null,adultsAmountInput:null,childrenAmountInput:null,dependencyCtrl:null,singleInputTriggers:[],multipleInputsTriggers:[],init:function(t,i){this._super(t,i),this.mainWrapper=this.element.children(".mphb-amount-inputs"),this.singleInputGroup=this.mainWrapper.children(".mphb-amount-single-input-group"),this.multipleInputsGroup=this.mainWrapper.children(".mphb-amount-multiple-inputs-group"),this.commonAmountInput=this.singleInputGroup.find("input.mphb-amount-common-input"),this.adultsAmountInput=this.multipleInputsGroup.find("input.mphb-amount-adults-input"),this.childrenAmountInput=this.multipleInputsGroup.find("input.mphb-amount-children-input");var n=this.mainWrapper.attr("data-dependency");if(n){var r=this;this.dependencyCtrl=this.element.closest("form").find('[name="'+n+'"]'),this.dependencyCtrl.on("change",function(t){var i=e(this).val();r.onTrigger(i)})}this.singleInputTriggers=this.mainWrapper.attr("data-single-triggers").split(","),this.multipleInputsTriggers=this.mainWrapper.attr("data-multiple-triggers").split(",")},onTrigger:function(e){var t=-1!=this.singleInputTriggers.indexOf(e),i=-1!=this.multipleInputsTriggers.indexOf(e);-1!=e.indexOf("percent")?this.mainWrapper.attr("data-render-type","percentage"):this.mainWrapper.attr("data-render-type","price"),t?this.switchToSingleInput():i&&this.switchToMultipleInputs()},switchToSingleInput:function(){this.adultsAmountInput.prop("disabled",!0),this.childrenAmountInput.prop("disabled",!0),this.commonAmountInput.prop("disabled",!1),this.multipleInputsGroup.addClass("mphb-hide"),this.singleInputGroup.removeClass("mphb-hide")},switchToMultipleInputs:function(){this.commonAmountInput.prop("disabled",!0),this.adultsAmountInput.prop("disabled",!1),this.childrenAmountInput.prop("disabled",!1),this.singleInputGroup.addClass("mphb-hide"),this.multipleInputsGroup.removeClass("mphb-hide")}}),MPHB.ColorPickerCtrl=MPHB.Ctrl.extend({},{input:null,init:function(e,t){this._super(e,t),this.input=this.element.find("input"),this.input.spectrum({allowEmpty:!0,preferredFormat:"hex",showInput:!0,showInitial:!0,showAlpha:!1})}}),MPHB.ComplexCtrl=MPHB.Ctrl.extend({},{prototypeItem:null,itemsHolder:null,lastIndex:null,uniqid:null,itemSelector:"tr",metaName:null,init:function(e,t){this._super(e,t),this.uniqid=this.element.children("table").attr("data-uniqid"),this.metaName=this.element.children('input[type="hidden"]:first-of-type').attr("name"),this.initItemsHolder(),this.initAddBtn(),this.initDeleteBtns(),this.preparePrototypeItem(),this.initLastIndex(),this.setKeys(this.itemsHolder.children(this.itemSelector))},makeItemsHolderSortable:function(){this.itemsHolder.sortable()},initLastIndex:function(){this.lastIndex=0;var t=this;this.itemsHolder.children(this.itemSelector).each(function(i,n){t.lastIndex=Math.max(t.lastIndex,parseInt(e(n).attr("data-id")))})},initItemsHolder:function(){this.itemsHolder=this.element.children("table").children("tbody"),this.itemsHolder.hasClass("mphb-sortable")&&this.makeItemsHolderSortable()},initAddBtn:function(){var e=this;this.element.on("click",'.mphb-complex-add-item[data-id="'+this.uniqid+'"]',function(t){e.addItem()})},initDeleteBtns:function(){var t=this;this.itemsHolder.on("click",'.mphb-complex-delete-item[data-id="'+this.uniqid+'"]',function(i){t.deleteItem(e(this).closest(t.itemSelector))})},preparePrototypeItem:function(){var t=this.itemsHolder.children(".mphb-complex-item-prototype");this.prototypeItem=t.clone(),this.prototypeItem.removeClass("mphb-hide mphb-complex-item-prototype").find("[name]").each(function(){e(this).removeAttr("disabled")}),t.remove()},getIncIndex:function(){return++this.lastIndex},setKeys:function(t){var i,n,r,s,a,l,o=this,h=new RegExp("%key_"+this.uniqid+"%","g"),d="%key_"+this.uniqid+"%";t.each(function(t,p){l=e(p),s=l.attr("data-id"),s===d&&(s=o.getIncIndex(),l.attr("data-id",s)),l.find('[name*="[%key_'+o.uniqid+'%]"]').each(function(){i=e(this).attr("name").replace(h,s),e(this).attr("name",i),e(this).attr("id")&&(n=e(this).attr("id").replace(h,s).replace(/\[|\]/g,"__"),e(this).attr("name",i).attr("id",n))}),l.find('[for*="[%key_'+o.uniqid+'%]"]').each(function(){r=e(this).attr("for").replace(h,s).replace(/\[|\]/g,"__"),e(this).attr("for",r)}),l.find('[data-dependency*="%key_'+o.uniqid+'%"]').each(function(){a=e(this).attr("data-dependency").replace(h,s),e(this).attr("data-dependency",a)})})},clonePrototypeItem:function(){var e=this.prototypeItem.clone();return this.setKeys(e),e},addItemToHolder:function(e){this.itemsHolder.append(e)},deleteItem:function(e){e.remove()},addItem:function(){var e=this.clonePrototypeItem();this.addItemToHolder(e);var t=e.find(".mphb-ctrl:not([data-inited])");MPHB.Plugin.myThis.setControls(t)}}),MPHB.ComplexVerticalCtrl=MPHB.ComplexCtrl.extend({},{itemSelector:"tbody",lastIndexInput:null,minItemsCount:0,init:function(e,t){this._super(e,t),this.minItemsCount=this.itemsHolder.attr("data-min-items-count")},initLastIndex:function(){this.lastIndexInput=this.itemsHolder.find(">tfoot .mphb-complex-last-index"),this.lastIndex=this.lastIndexInput.val()},getIncIndex:function(){var e=this._super();return this.lastIndexInput.val(e),e},initItemsHolder:function(){this.itemsHolder=this.element.children("table")},addItemToHolder:function(e){this.itemsHolder.children("tfoot").before(e)},disableDeleteButtons:function(){this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item").attr("disabled","disabled").addClass("mphb-hide")},enableDeleteButtons:function(){this.itemsHolder.children(this.itemSelector).children(".mphb-complex-item-actions-holder").find(".mphb-complex-delete-item").removeAttr("disabled").removeClass("mphb-hide")},updateItemActions:function(){this.itemsHolder.children(this.itemSelector).length<=this.minItemsCount?this.disableDeleteButtons():this.enableDeleteButtons()},updateDefaultItem:function(){var e=this.itemsHolder.children(this.itemSelector).find('>.mphb-complex-item-actions-holder [name="'+this.metaName+'[default]"]');e.filter(":checked").length||e.first().attr("checked","checked")},deleteItem:function(e){this._super(e),this.updateItemActions(),this.updateDefaultItem()},addItem:function(){this._super(),this.updateItemActions(),this.updateDefaultItem()}}),MPHB.DatePickerCtrl=MPHB.Ctrl.extend({renderValue:function(e){return e.find('input[type="text"]').val()}},{input:null,hiddenInput:null,init:function(t,i){if(this._super(t,i),this.input=this.element.find('input[type="text"]'),this.hiddenInput=this.element.find('input[type="hidden"]'),this.fixDate(),this.input.attr("readonly")||this.input.datepick({dateFormat:MPHB.Plugin.myThis.data.settings.dateFormat,altField:this.hiddenInput,altFormat:MPHB.Plugin.myThis.data.settings.dateTransferFormat,showSpeed:0,showOtherMonths:!1,monthsToShow:MPHB.Plugin.myThis.data.settings.numberOfMonthDatepicker,pickerClass:MPHB.Plugin.myThis.data.settings.datepickerClass}),!this.input.attr("required")){var n=this.hiddenInput;this.input.on("change",function(){""==e(this).val()&&n.val("")})}},fixDate:function(){if(this.hiddenInput.val()){var t=e.datepick.parseDate(MPHB.Plugin.myThis.data.settings.dateTransferFormat,this.hiddenInput.val()),i=e.datepick.formatDate(MPHB.Plugin.myThis.data.settings.dateFormat,t);this.input.val(i)}else;}}),MPHB.DynamicSelectCtrl=MPHB.Ctrl.extend({},{input:null,dependencyCtrl:null,ajaxAction:null,ajaxNonce:null,errorsWrapper:null,preloader:null,defaultValue:null,defaultOption:null,complexId:null,group:"",init:function(e,t){this._super(e,t),this.input=this.element.find("select"),this.defaultValue=this.input.attr("data-default"),this.defaultOption=this.input.find('option[value="'+this.defaultValue+'"]').clone(),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader"),this.ajaxAction=this.input.attr("data-ajax-action"),this.ajaxNonce=this.input.attr("data-ajax-nonce"),this.initDependencyCtrl(),this.initComplexId(),this.initGroup()},initDependencyCtrl:function(){var e=this.input.attr("data-dependency");this.dependencyCtrl=this.element.closest("form").find('[name="'+e+'"]');var t=this;this.dependencyCtrl.on("change",function(e){t.updateList()}).on("focus",function(e){t.hideErrors()})},initComplexId:function(){var e=this.element.parents("tr[data-id]");e.length>0&&(this.complexId=parseInt(e.attr("data-id")))},initGroup:function(){var e=this.element.parents(".mphb-ctrl-rules-list");e.length>0&&(this.group=e.attr("data-group"))},setOptions:function(t){var i=this;this.input.html(this.defaultOption.clone()),e.each(t,function(t,n){i.input.append(e("<option />",{value:t,html:n}))})},updateList:function(){var t=this;this.hideErrors(),this.showPreloader(),this.input.html(this.defaultOption.clone());var i={action:this.ajaxAction,mphb_nonce:this.ajaxNonce,formValues:this.parseFormToJSON()};e.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"GET",dataType:"json",data:i,success:function(e){e.hasOwnProperty("success")?e.success?t.setOptions(e.data.options):t.showError(e.data.message):t.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(e){t.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(e){t.hidePreloader()}})},parseFormToJSON:function(){var e=this.parentForm.serializeJSON();return""!=this.group&&(e=e[this.group]),null!=this.complexId&&(e=e[this.complexId]),e},showPreloader:function(){this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.preloader.addClass("mphb-hide")},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},showError:function(e){this.errorsWrapper.html(e).removeClass("mphb-hide")}}),MPHB.GalleryCtrl=MPHB.Ctrl.extend({},{input:null,previewHolder:null,addGalleryBtn:null,removeGalleryBtn:null,init:function(e,t){this._super(e,t),this.input=this.element.find("input[type=hidden]"),this.previewHolder=this.element.find("img").on("click",this.proxy("organizeGallery")),this.addGalleryBtn=this.element.find(".mphb-admin-organize-gallery-add").on("click",this.proxy("organizeGallery")),this.removeGalleryBtn=this.element.find(".mphb-admin-organize-gallery-remove").on("click",this.proxy("removeGallery"))},get:function(){return this.input.val()},getArray:function(){return""!==this.get()?this.get().split(/,/):[]},set:function(e){this.input.val(e),this.updatePreview(),this.updateBtnsVisibility()},updateBtnsVisibility:function(){""!==this.get()?(this.removeGalleryBtn.removeClass("mphb-hide"),this.addGalleryBtn.addClass("mphb-hide")):(this.removeGalleryBtn.addClass("mphb-hide"),this.addGalleryBtn.removeClass("mphb-hide"))},updatePreview:function(){var e=this.get();if(""!==e){var t=e.split(",").shift(),i=wp.media.attachment(t),n=i.attributes.sizes.medium.url;this.previewHolder.removeClass("mphb-hide").attr("src",n)}else this.previewHolder.addClass("mphb-hide").attr("src","")},organizeGallery:function(e){e.preventDefault(),MPHB.WPGallery.getInstance().open(this)},removeGallery:function(e){e.preventDefault(),this.set("")}}),MPHB.MultipleCheckboxCtrl=MPHB.Ctrl.extend({renderValue:function(t){var i=t.find('input[type="checkbox"]'),n=i.filter(".mphb-checkbox-all:checked"),r=i.filter(":checked");if(n.length>0||r.length==i.length)return MPHB.Plugin.myThis.data.translations.all;var s=[];return r.each(function(){var t=e(this).parent().text();s.push(t)}),s.length>0?s.join(", "):MPHB.Plugin.myThis.data.translations.none}},{checkboxes:null,selectAllCheckbox:null,init:function(e,t){this._super(e,t),this.checkboxes=this.element.find('input[type="checkbox"]:not(.mphb-checkbox-all)'),this.selectAllCheckbox=this.element.find('input[type="checkbox"].mphb-checkbox-all'),this.selectAllCheckbox.prop("checked")&&this.disableCheckboxes()},".mphb-checkbox-all click":function(){this.selectAllCheckbox.prop("checked")?(this.disableCheckboxes(),this.selectCheckboxes()):this.enableCheckboxes()},".mphb-checkbox-select-all click":function(e,t){t.preventDefault(),this.selectCheckboxes()},".mphb-checkbox-unselect-all click":function(e,t){t.preventDefault(),this.unselectAll(),this.enableCheckboxes()},disableCheckboxes:function(){this.checkboxes.prop("disabled",!0)},enableCheckboxes:function(){this.checkboxes.prop("disabled",!1)},selectCheckboxes:function(){this.checkboxes.prop("checked",!0)},unselectCheckboxes:function(){this.checkboxes.prop("checked",!1)},unselectAll:function(){this.selectAllCheckbox.prop("checked",!1),this.unselectCheckboxes()}}),MPHB.NumberCtrl=MPHB.Ctrl.extend({renderValue:function(e){var t=e.children('input[type="number"]');return t.val()+t.parent().text()}},{input:null,disableOn:[],init:function(t,i){this._super(t,i),this.input=this.element.children("[name]");var n=this.input.attr("data-dependency"),r=this.input.attr("data-disable-on");if(n&&r){this.disableOn=r.split(",");var s=this;this.element.closest("form").find('[name="'+n+'"]').on("change",function(t){var i=e(this).val();s.onDependencyChange(i)})}},onDependencyChange:function(e){-1!=this.disableOn.indexOf(e)?this.input.prop("disabled",!0):this.input.prop("disabled",!1)}}),MPHB.PriceBreakdownCtrl=MPHB.Ctrl.extend({},{".mphb-price-breakdown-expand click":function(t,i){i.preventDefault(),e(t).blur();var n=e(t).parents("tr.mphb-price-breakdown-group");n.find(".mphb-price-breakdown-rate").toggleClass("mphb-hide"),n.nextUntil("tr.mphb-price-breakdown-group").toggleClass("mphb-hide")}}),MPHB.RulesListCtrl=MPHB.Ctrl.extend({},{editClass:"mphb-rules-list-editing",editText:"",doneText:"",lastIndex:-1,rulesCount:0,table:null,tbody:null,rulePrototype:null,editingRule:null,noRulesMessage:null,prependNewItems:!1,init:function(t,i){this._super(t,i),this.editText=MPHB.Plugin.myThis.data.translations.edit,this.doneText=MPHB.Plugin.myThis.data.translations.done,this.noRulesMessage=t.find(".mphb-rules-list-empty-message"),this.table=t.children("table"),this.tbody=this.table.children("tbody"),this.tbody.hasClass("mphb-sortable")&&(this.tbody.sortable(),this.prependNewItems=!0);var n=this.tbody.children(".mphb-rules-list-prototype"),r=n.clone();n.remove(),r.removeClass("mphb-rules-list-prototype mphb-hide"),r.find(".mphb-ctrl:not(.mphb-keep-disabled) [name]:not(.mphb-keep-disabled)").each(function(){e(this).prop("disabled",!1)}),this.rulePrototype=r;var s=this.tbody.children("tr"),a=this.lastIndex;s.each(function(){var t=parseInt(e(this).attr("data-id"));a=Math.max(a,t)}),this.lastIndex=a,this.rulesCount=s.length},".mphb-rules-list-add-button click":function(){this.addRule()},".mphb-rules-list-edit-button click":function(e,t){var i=this.getRuleByButton(e);this.toggleEdit(i)},".mphb-rules-list-delete-button click":function(e,t){var i=this.getRuleByButton(e);this.deleteRule(i)},addRule:function(){var t=this.rulePrototype.clone(),i=this.nextIndex();t.attr("data-id",i),t.find('[name*="[$index$]"]').each(function(){var t=e(this),n=t.attr("name");n=n.replace("$index$",i),t.attr("name",n);var r=t.attr("id");r&&(r=r.replace("$index$",i),t.attr("id",r))}),t.find('[data-dependency*="[$index$]"]').each(function(){var t=e(this),n=t.attr("data-dependency");n=n.replace("$index$",i),t.attr("data-dependency",n)}),this.prependNewItems?this.tbody.prepend(t):this.tbody.append(t),this.increaseRulesCount();var n=t.find(".mphb-ctrl:not([data-inited])");MPHB.Plugin.myThis.setControls(n),this.toggleEdit(t)},toggleEdit:function(e){null!=this.editingRule&&(this.renderValues(this.editingRule),this.editingRule.removeClass(this.editClass),this.editingRule.find(".mphb-rules-list-edit-button").text(this.editText)),this.isEditingRule(e)?this.editingRule=null:(this.editingRule=e,e.addClass(this.editClass),e.find(".mphb-rules-list-edit-button").text(this.doneText))},deleteRule:function(e){this.isEditingRule(e)&&(this.editingRule=null),e.remove(),this.decreaseRulesCount()},isEditingRule:function(e){return null!=this.editingRule&&e[0]===this.editingRule[0]},getRuleByButton:function(e){return e.closest("tr")},increaseRulesCount:function(){0==this.rulesCount&&(this.noRulesMessage.addClass("mphb-hide"),this.table.removeClass("mphb-hide")),this.rulesCount++},decreaseRulesCount:function(){0==--this.rulesCount&&(this.table.addClass("mphb-hide"),this.noRulesMessage.removeClass("mphb-hide"))},nextIndex:function(){return++this.lastIndex},renderValues:function(t){var i=this;t.children("td").each(function(){var t=e(this),n=t.children(".mphb-ctrl");if(0!=n.length){var r=i.renderValue(n);t.children(".mphb-rules-list-rendered-value").html(r)}})},renderValue:function(e){var t=e.attr("data-type"),i="";switch(t){case"text":i=MPHB.Ctrl.renderValue(e);break;case"datepicker":i=MPHB.DatePickerCtrl.renderValue(e);break;case"textarea":i=e.find("textarea").val();break;case"number":i=MPHB.NumberCtrl.renderValue(e);break;case"select":case"dynamic-select":var n=e.children("select"),r=n.val();if(void 0!=r){i=n.children('option[value="'+r+'"]').text()}else i=MPHB.Plugin.myThis.data.translations.none;break;case"multiple-checkbox":i=MPHB.MultipleCheckboxCtrl.renderValue(e);break;case"amount":i=MPHB.AmountCtrl.renderValue(e);break;case"placeholder":i="-"}return i}}),MPHB.TotalPriceCtrl=MPHB.Ctrl.extend({},{preloader:null,input:null,init:function(e,t){this._super(e,t),this.input=this.element.find("input"),this.recalculateBtn=this.element.find("#mphb-recalculate-total-price"),this.errorsWrapper=this.element.find(".mphb-errors-wrapper"),this.preloader=this.element.find(".mphb-preloader")},set:function(e){this.input.val(e)},hideErrors:function(){this.errorsWrapper.empty().addClass("mphb-hide")},"input focus":function(){this.hideErrors()},showError:function(e){this.errorsWrapper.html(e).removeClass("mphb-hide")},"#mphb-recalculate-total-price click":function(t,i){var n=this;this.hideErrors(),this.showPreloader();var r=this.parseFormToJSON();e.ajax({url:MPHB.Plugin.myThis.data.ajaxUrl,type:"POST",dataType:"json",data:{action:"mphb_recalculate_total",mphb_nonce:MPHB.Plugin.myThis.data.nonces.mphb_recalculate_total,formValues:r},success:function(e){if(e.hasOwnProperty("success"))if(e.success){n.set(e.data.total);var t=n.element.closest("form").find('[name="_mphb_booking_price_breakdown"]'),i=t.siblings(".mphb-price-breakdown-wrapper");t.val(e.data.price_breakdown),t.prop("disabled",!1),i.html(e.data.price_breakdown_html)}else n.showError(e.data.message);else n.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},error:function(e){n.showError(MPHB.Plugin.myThis.data.translations.errorHasOccured)},complete:function(e){n.hidePreloader()}})},showPreloader:function(){this.recalculateBtn.attr("disabled","disabled"),this.preloader.removeClass("mphb-hide")},hidePreloader:function(){this.recalculateBtn.removeAttr("disabled"),this.preloader.addClass("mphb-hide")},parseFormToJSON:function(){return this.parentForm.serializeJSON()}}),new MPHB.Plugin,e(function(){e(".mphb-bookings-calendar-wrapper")&&new MPHB.BookingsCalendar(e(".mphb-bookings-calendar-wrapper"))})})}(jQuery);